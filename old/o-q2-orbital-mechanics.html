<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, shrink-to-fit=no">
<title>Q2 ‚Äì Orbital Mechanics & Constellations 101 ‚Ä¢ LEOAF</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing:border-box; margin:0; padding:0; }
body { background:#000; color:#f0f0f0; font-family:'Inter',sans-serif; line-height:1.65; min-height:100vh; }

/* Header */
header {
    background:#000;
    border-bottom:1px solid #ff004f33;
    position:sticky; top:0; z-index:100;
    padding:1rem clamp(1.5rem,5vw,4rem);
    display:flex; justify-content:space-between; align-items:center;
    box-shadow:0 4px 16px #0008;
}
.nav-left { display:flex; align-items:center; gap:2rem; }
.logo { font-family:'Orbitron',sans-serif; font-size:clamp(1.4rem,4vw,2rem); font-weight:800; letter-spacing:3px; text-decoration:none; }
.logo span:first-child { color:#fff; }
.logo span:last-child { color:#ff004f; }
.back-dashboard { color:#00d9ff; font-size:0.95rem; text-decoration:none; }
.back-dashboard:hover { color:#39ff14; text-decoration:underline; }
.logoff-btn {
    background:transparent; border:1px solid #ff004f; color:#ff004f;
    padding:0.5rem 1rem; font-size:0.85rem; cursor:pointer; border-radius:4px;
}
.logoff-btn:hover { background:#ff004f; color:#000; }

/* Content */
.content { max-width:960px; margin:0 auto; padding:clamp(100px,12vh,140px) 1.5rem 4rem; }
h1 { font-family:'Orbitron',sans-serif; font-size:clamp(2.2rem,6vw,3.6rem); text-align:center; margin-bottom:1.5rem; letter-spacing:1px; color:#00d9ff; }

/* Quarter status button */
.check-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    margin: 0 auto 2.5rem;
    cursor: pointer;
    width: fit-content;
    padding: 0.75rem 1.5rem;
    border: 1px solid #ff004f44;
    border-radius: 8px;
    transition: all 0.2s ease;
    background: rgba(255, 0, 79, 0.05);
}
.check-container:hover { border-color: #ff004f; background: rgba(255, 0, 79, 0.1); }
.check-container.completed { border-color: #39ff1444; background: rgba(57, 255, 20, 0.05); }
.check-container.completed:hover { border-color: #39ff14; background: rgba(57, 255, 20, 0.1); }
.check-label {
    font-size: 0.9rem; letter-spacing: 1px; color: #aaa;
    font-family: 'Orbitron', sans-serif; font-weight: 600;
}
.custom-checkbox {
    width: 28px; height: 28px; border: 2px solid #ff004f; border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    background: transparent; transition: all 0.2s; flex-shrink: 0;
}
.custom-checkbox.checked { border-color: #39ff14; background: rgba(57, 255, 20, 0.25); }
.custom-checkbox.checked::after { content: 'üöÄ'; font-size: 1.1rem; }

/* Cards */
.section-card {
    background:rgba(255,255,255,0.025); border:1px solid rgba(0,217,255,0.15);
    border-radius:12px; padding:2rem; margin:2.5rem 0; box-shadow:0 4px 20px #0008;
}
.section-card h2 { font-family:'Orbitron',sans-serif; color:#00d9ff; font-size:1.55rem; margin-bottom:1.2rem; }

/* Accordions */
.accordion-header {
    background:rgba(0,217,255,0.06); padding:1.1rem 1.4rem; border-radius:8px;
    margin:1rem 0; cursor:pointer; display:flex; align-items:center; gap:1rem;
    transition:all 0.2s ease;
}
.accordion-header:hover { background:rgba(0,217,255,0.12); transform:translateX(6px); }
.accordion-header.active { background:rgba(57,255,20,0.12); }
.accordion-header .check-small { width:26px; height:26px; flex-shrink:0; pointer-events:none; }
.custom-checkbox-small {
    width:22px; height:22px; border:2px solid #888; border-radius:4px;
    display:flex; align-items:center; justify-content:center;
}
.custom-checkbox-small.checked { border-color:#39ff14; background:rgba(57,255,20,0.25); }
.custom-checkbox-small.checked::after { content:'‚úì'; color:#39ff14; font-weight:bold; }
.accordion-header h3 { margin:0; font-size:1.15rem; flex:1; }
.accordion-content {
    display:none; padding:1.8rem 1.6rem 2.2rem; background:rgba(0,0,0,0.35);
    border-radius:0 0 8px 8px; border:1px solid rgba(57,255,20,0.2); margin-top:-8px;
}
.close-accordion {
    display:block; margin:1.8rem auto 0.5rem; padding:0.5rem 1.2rem;
    background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12);
    border-radius:6px; color:#aaa; cursor:pointer; font-size:0.82rem;
    text-align:center; width:fit-content; transition:all 0.2s;
}
.close-accordion:hover { background:rgba(255,255,255,0.12); color:#fff; }

/* Other styles */
.equation { font-family:monospace; background:#111; padding:1.2rem; border-radius:8px; margin:1.2rem 0; color:#00d9ff; line-height:1.4; }
.code-snippet { background:#0a0a0a; padding:1.4rem; border-radius:8px; font-family:monospace; font-size:0.93rem; overflow-x:auto; margin:1.5rem 0; border-left:4px solid #39ff14; position:relative; }
.takeaway { background:rgba(57,255,20,0.08); border-left:4px solid #39ff14; padding:1.2rem; border-radius:6px; margin:1.5rem 0; font-style:italic; }
.mark-done-btn { margin-top:1.8rem; padding:0.75rem 1.6rem; background:rgba(57,255,20,0.2); border:none; border-radius:6px; color:#fff; cursor:pointer; min-width:220px; text-align:center; }
.mark-done-btn.checked { background:rgba(57,255,20,0.45); }
.mission-note { text-align:center; margin:6rem 0 3rem; font-size:1.05rem; color:#00d9ff88; font-style:italic; }

/* HAL 9000 Modal */
.modal-overlay {
    display:none; position:fixed; inset:0;
    background:rgba(0,0,0,0.85); z-index:1000;
    align-items:center; justify-content:center;
}
.modal-overlay.active { display:flex; }
.modal-box {
    background:#000; border:1px solid #00d9ff44; border-radius:4px;
    max-width:420px; width:90%; padding:2.5rem 2rem; text-align:center;
    box-shadow:0 0 60px #00d9ff11, 0 0 120px #00000099;
    font-family:'Orbitron',sans-serif;
}
.modal-eye {
    font-size:3rem; margin-bottom:1.5rem; display:block;
    filter:drop-shadow(0 0 12px #ff004f);
}
.modal-title {
    font-size:0.75rem; letter-spacing:4px; color:#00d9ff;
    text-transform:uppercase; margin-bottom:1rem;
}
.modal-message {
    font-size:1rem; color:#f0f0f0; line-height:1.7; margin-bottom:2rem;
    font-family:'Inter',sans-serif; font-style:italic;
}
.modal-buttons { display:flex; gap:1rem; justify-content:center; }
.modal-btn {
    padding:0.6rem 1.4rem; font-family:'Orbitron',sans-serif;
    font-size:0.75rem; letter-spacing:2px; border-radius:4px;
    cursor:pointer; transition:all 0.2s;
}
.modal-btn-confirm { background:transparent; border:1px solid #00d9ff; color:#00d9ff; }
.modal-btn-confirm:hover { background:#00d9ff; color:#000; }
.modal-btn-cancel { background:transparent; border:1px solid #ffffff22; color:#666; }
.modal-btn-cancel:hover { border-color:#ff004f; color:#ff004f; }
</style>
</head>
<body>

<header>
    <div class="nav-left">
        <a href="dashboard.html" class="logo"><span>LEO</span><span>AF</span></a>
        <a href="dashboard.html" class="back-dashboard">‚Üê Mission Dashboard</a>
    </div>
    <button id="logoffBtn" class="logoff-btn">ABORT</button>
</header>

<div class="content">

    <h1>Q2 ‚Äì Orbital Mechanics & Constellations 101</h1>

    <div class="check-container" id="quarterCheck">
        <div class="custom-checkbox"></div>
        <span class="check-label">MARK QUARTER COMPLETE</span>
    </div>

    <div class="section-card">
        <h2>üéØ What you'll master this quarter</h2>
        <p>GEO sits still. LEO screams around Earth ~15√ó a day. This quarter turns fast motion from "scary" to "I get it" ‚Äî with real simulations.</p>
    </div>

    <div class="section-card">
        <h2>Core Topics ‚Äì click any header to expand üöÄ</h2>

        <div class="accordion-header" data-target="topic1">
            <div class="check-small" data-id="q2_topic1"><div class="custom-checkbox-small"></div></div>
            <h3>1. Newton's law of gravitation & centripetal force balance</h3>
        </div>
        <div id="topic1" class="accordion-content">
            <h4>Why this section exists</h4>
            <p>This is ground zero for understanding orbits. Every LEO challenge (handovers every 5‚Äì10 min, huge constellations, strong Doppler, short passes) comes from satellites moving very fast. This equation explains why.</p>
            <h4>The physics ‚Äì coffee cup vs satellite</h4>
            <p>Gravity pulls the satellite toward Earth's center. Its forward speed wants to fly it straight into space. Perfect balance ‚Üí stable circular orbit.</p>
            <div class="equation">
                Gravitational force = Centripetal force<br>
                G √ó M_earth √ó m / r¬≤  =  m √ó v¬≤ / r
            </div>
            <p>Satellite mass (m) cancels ‚Üí orbital velocity:</p>
            <div class="equation">v = ‚àö(G M_earth / r)</div>
            <h4>Real numbers ‚Äì LEO vs GEO</h4>
            <table style="width:100%; margin:1.5rem 0; background:#111; border-radius:8px; overflow:hidden; font-size:0.95rem;">
                <tr style="background:#1a1a1a;"><th style="padding:12px;">Orbit</th><th>Altitude</th><th>Speed</th><th>Period</th><th>Orbits/day</th></tr>
                <tr><td style="padding:12px;">Starlink LEO</td><td>~550 km</td><td>7.67 km/s</td><td>95.6 min</td><td>15.1</td></tr>
                <tr><td style="padding:12px;">ISS</td><td>~400 km</td><td>7.66 km/s</td><td>92.7 min</td><td>15.5</td></tr>
                <tr><td style="padding:12px;">GEO</td><td>35,786 km</td><td>3.07 km/s</td><td>24 h</td><td>1</td></tr>
            </table>
            <h4>Real-life translation</h4>
            <ul>
                <li>LEO satellite circles Earth ~15√ó per day ‚Üí disappears over horizon in minutes.</li>
                <li>Aircraft terminal must switch satellites constantly ‚Üí phased arrays & predictive handovers required.</li>
                <li>GEO stays fixed ‚Üí no handovers, but ~600 ms latency (bad for real-time apps).</li>
                <li>LEO ~20‚Äì40 ms latency ‚Üí huge win for aviation, but needs thousands of satellites.</li>
            </ul>
            <div class="takeaway">
                <strong>One-sentence takeaway:</strong> Lower altitude = dramatically faster satellites = many more needed for continuous coverage. That explains Starlink's ~9,800 satellites vs 3‚Äì5 GEO satellites.
            </div>
            <h4>Try it yourself ‚Äì copy-paste & run</h4>
            <div class="code-snippet">
<pre><code class="language-python">
import math

G = 6.67430e-11
M_earth = 5.972e24
R_earth = 6371000

def orbital_velocity(altitude_km):
    r = R_earth + altitude_km * 1000
    v_ms = math.sqrt(G * M_earth / r)
    return v_ms / 1000

leo_speed = orbital_velocity(550)
print(f"550 km LEO speed  : {round(leo_speed, 2)} km/s")
geo_speed = orbital_velocity(35786)
print(f"GEO speed         : {round(geo_speed, 2)} km/s")
meo_speed = orbital_velocity(20200)
print(f"20,200 km MEO speed: {round(meo_speed, 2)} km/s")
</code></pre>
            </div>
            <p><strong>How to run it:</strong></p>
            <ol style="margin-left:1.5rem; color:#ccc;">
                <li><strong>Fastest:</strong> <a href="https://replit.com/languages/python3" target="_blank" style="color:#00d9ff;">replit.com</a> ‚Üí paste ‚Üí Run</li>
                <li><strong>Best for learning:</strong> <a href="https://colab.research.google.com" target="_blank" style="color:#00d9ff;">Google Colab</a> ‚Üí New notebook ‚Üí paste ‚Üí Shift+Enter</li>
                <li><strong>Local:</strong> Save as orbit_speed.py ‚Üí python orbit_speed.py</li>
            </ol>
            <button class="mark-done-btn" data-id="q2_topic1">Mark as complete</button>
            <button class="close-accordion" onclick="closeAccordion('topic1')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic2">
            <div class="check-small" data-id="q2_topic2"><div class="custom-checkbox-small"></div></div>
            <h3>2. Kepler's third law ‚Äì orbital period vs altitude</h3>
        </div>
        <div id="topic2" class="accordion-content">
            <h4>Why this section exists</h4>
            <p>Newton gave us the "how fast" part. Kepler's third law gives us the "how long" part ‚Äî how long it takes a satellite to complete one full orbit.</p>
            <div class="equation">T¬≤ ‚àù a¬≥ ‚Üí T = 2œÄ ‚àö(a¬≥ / Œº)</div>
            <table style="width:100%; margin:1.5rem 0; background:#111; border-radius:8px; overflow:hidden; font-size:0.95rem;">
                <tr style="background:#1a1a1a;"><th style="padding:12px;">Orbit</th><th>Altitude</th><th>Period</th><th>Orbits/day</th></tr>
                <tr><td style="padding:12px;">ISS</td><td>~400 km</td><td>~92.7 min</td><td>~15.5</td></tr>
                <tr><td style="padding:12px;">Starlink</td><td>~550 km</td><td>~95.6 min</td><td>~15.1</td></tr>
                <tr><td style="padding:12px;">GPS MEO</td><td>~20,200 km</td><td>~12 hours</td><td>~2</td></tr>
                <tr><td style="padding:12px;">GEO</td><td>35,786 km</td><td>24 h</td><td>1</td></tr>
            </table>
            <div class="takeaway">
                <strong>One-sentence takeaway:</strong> The higher you go, the slower the orbit ‚Äî that's why LEO needs ~15 orbits per day while GEO only needs 1.
            </div>
            <button class="mark-done-btn" data-id="q2_topic2">Mark as complete</button>
            <button class="close-accordion" onclick="closeAccordion('topic2')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic3">
            <div class="check-small" data-id="q2_topic3"><div class="custom-checkbox-small"></div></div>
            <h3>3. Satellite visibility cone & pass duration</h3>
        </div>
        <div id="topic3" class="accordion-content">
            <p>Coming soon üåå</p>
            <button class="close-accordion" onclick="closeAccordion('topic3')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic4">
            <div class="check-small" data-id="q2_topic4"><div class="custom-checkbox-small"></div></div>
            <h3>4. LEO ground tracks & nodal precession (J‚ÇÇ effect)</h3>
        </div>
        <div id="topic4" class="accordion-content">
            <p>Coming soon üåå</p>
            <button class="close-accordion" onclick="closeAccordion('topic4')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic5">
            <div class="check-small" data-id="q2_topic5"><div class="custom-checkbox-small"></div></div>
            <h3>5. Visibility, passes & handover frequency</h3>
        </div>
        <div id="topic5" class="accordion-content">
            <p>Coming soon üåå</p>
            <button class="close-accordion" onclick="closeAccordion('topic5')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic6">
            <div class="check-small" data-id="q2_topic6"><div class="custom-checkbox-small"></div></div>
            <h3>6. Constellation fundamentals (Walker patterns, streets-of-coverage)</h3>
        </div>
        <div id="topic6" class="accordion-content">
            <p>Coming soon üåå</p>
            <button class="close-accordion" onclick="closeAccordion('topic6')">Collapse ‚Üë</button>
        </div>

        <div class="accordion-header" data-target="topic7">
            <div class="check-small" data-id="q2_topic7"><div class="custom-checkbox-small"></div></div>
            <h3>7. Tools & data sources (SGP4, TLEs, Celestrak, Skyfield, Poliastro)</h3>
        </div>
        <div id="topic7" class="accordion-content">
            <p>Coming soon üåå</p>
            <button class="close-accordion" onclick="closeAccordion('topic7')">Collapse ‚Üë</button>
        </div>

    </div>

    <div class="section-card">
        <h2>üìö Best free resources</h2>
        <ul>
            <li>MIT OCW ‚Äì Aerospace orbital mechanics lectures</li>
            <li>YouTube ‚Äì Prof. Shane Ross Orbital Mechanics playlist</li>
            <li>Fundamentals of Astrodynamics (free PDF excerpts, Ch 1‚Äì4)</li>
            <li>Poliastro & Skyfield Python tutorials</li>
            <li>NASA GMAT ‚Äì free tool + beginner guides</li>
        </ul>
    </div>

    <div class="section-card">
        <h2>üõ†Ô∏è Hands-on this quarter</h2>
        <ul>
            <li>Ground-track plot of a real satellite</li>
            <li>Visibility passes over Toulouse for 1 week</li>
            <li>LEO vs GEO velocity & period comparison</li>
            <li>GitHub folder: /q2-orbital-mechanics</li>
        </ul>
    </div>

    <div class="mission-note">
        Motion is the biggest difference between GEO and LEO.<br>
        Nail it here ‚Üí command constellations later. üåå
    </div>

</div>

<!-- HAL 9000 Modal -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal-box">
        <span class="modal-eye" id="modalEye">üî¥</span>
        <div class="modal-title" id="modalTitle">MISSION CONTROL</div>
        <p class="modal-message" id="modalMessage"></p>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-confirm" id="modalConfirm">AFFIRMATIVE</button>
            <button class="modal-btn modal-btn-cancel" id="modalCancel">NEGATIVE</button>
        </div>
    </div>
</div>

<!-- 1. Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- 2. Supabase client init -->
<script src="supabase.js"></script>
<!-- 3. User progress functions -->
<script src="user_progress.js"></script>
<!-- 4. Page logic -->
<script>

// ‚îÄ‚îÄ Logoff ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('logoffBtn').addEventListener('click', async () => {
    await client.auth.signOut();
    window.location.href = "index.html";
});

// ‚îÄ‚îÄ Accordion toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.accordion-header').forEach(header => {
    header.addEventListener('click', e => {
        if (e.target.closest('.check-small')) return;
        const target = document.getElementById(header.dataset.target);
        const isOpen = target.style.display === 'block';
        target.style.display = isOpen ? 'none' : 'block';
        header.classList.toggle('active', !isOpen);
    });
});

function closeAccordion(targetId) {
    const content = document.getElementById(targetId);
    const header = content.previousElementSibling;
    content.style.display = 'none';
    header.classList.remove('active');
    header.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ‚îÄ‚îÄ HAL 9000 modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showConfirm(message, title, onConfirm) {
    document.getElementById('modalMessage').textContent = message;
    document.getElementById('modalTitle').textContent = title;
    const overlay = document.getElementById('confirmModal');
    overlay.classList.add('active');
    document.getElementById('modalConfirm').onclick = () => {
        overlay.classList.remove('active');
        onConfirm();
    };
    document.getElementById('modalCancel').onclick = () => {
        overlay.classList.remove('active');
    };
}

// ‚îÄ‚îÄ Set quarter visual state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setQuarterState(done) {
    const quarterCb = document.querySelector('#quarterCheck .custom-checkbox');
    const quarterContainer = document.getElementById('quarterCheck');
    if (!quarterCb) return;
    if (done) {
        quarterCb.classList.add('checked');
        quarterContainer.classList.add('completed');
    } else {
        quarterCb.classList.remove('checked');
        quarterContainer.classList.remove('completed');
    }
}

// ‚îÄ‚îÄ Auto-update quarter when topics change ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function updateQuarterVisual() {
    const total = document.querySelectorAll('.check-small').length;
    const checked = document.querySelectorAll('.custom-checkbox-small.checked').length;
    const done = checked === total && total > 0;
    setQuarterState(done);
    await upsertSection('q2-orbital-mechanics', done);
}

// ‚îÄ‚îÄ Manual quarter click ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('quarterCheck').addEventListener('click', async () => {
    const quarterCb = document.querySelector('#quarterCheck .custom-checkbox');
    const isCurrentlyChecked = quarterCb.classList.contains('checked');

    const message = isCurrentlyChecked
        ? "The four-million year old black monolith has remained completely inert. Its origin and purpose are still a total mystery. Go back if you wish."
        : "Just what do you think you're doing? I really think I'm entitled to an answer to that question. Answer below.";
    const title = isCurrentlyChecked ? 'REVERSION REQUESTED' : 'MISSION MILESTONE';

    showConfirm(message, title, async () => {
        const newState = !isCurrentlyChecked;
        setQuarterState(newState);
        await upsertSection('q2-orbital-mechanics', newState);
    });
});

// ‚îÄ‚îÄ Load saved progress from Supabase ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadProgress() {
    const mastered = await getMasteredSections();

    document.querySelectorAll('.check-small').forEach(el => {
        const id = el.dataset.id;
        if (mastered.includes(id)) {
            el.querySelector('.custom-checkbox-small')?.classList.add('checked');
        }
    });

    document.querySelectorAll('.mark-done-btn').forEach(btn => {
        const id = btn.dataset.id;
        const header = btn.closest('.accordion-content').previousElementSibling;
        const cb = header.querySelector('.custom-checkbox-small');
        if (mastered.includes(id)) {
            btn.textContent = 'Unmark / revisit';
            cb?.classList.add('checked');
        } else {
            btn.textContent = 'Mark as complete';
        }
    });

    const quarterRow = await getSection('q2-orbital-mechanics');
    setQuarterState(quarterRow && quarterRow.mastered);
}

// ‚îÄ‚îÄ Mark done button clicks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.mark-done-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const id = btn.dataset.id;
        const header = btn.closest('.accordion-content').previousElementSibling;
        const cb = header.querySelector('.custom-checkbox-small');
        const isChecked = cb.classList.toggle('checked');
        btn.textContent = isChecked ? 'Unmark / revisit' : 'Mark as complete';
        await upsertSection(id, isChecked);
        await updateQuarterVisual();
    });
});

// ‚îÄ‚îÄ Auth check + boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', async () => {
    const { data: { session } } = await client.auth.getSession();
    if (!session) { window.location.href = "index.html"; return; }
    await loadProgress();
});

</script>
</body>
</html>
