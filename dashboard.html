<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LEOAF Command Center</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    margin:0;
    font-family:'Orbitron', sans-serif;
    background:black;
    color:white;
    overflow-x:hidden;
}

/* Subtle starfield */
body::before {
    content:"";
    position:fixed;
    width:200%;
    height:200%;
    background-image:
        radial-gradient(white 1px, transparent 1px),
        radial-gradient(#00d9ff 1px, transparent 1px),
        radial-gradient(#ff004f 1px, transparent 1px);
    background-size:120px 120px, 160px 160px, 200px 200px;
    animation: drift 60s linear infinite;
    opacity:0.15;
}

@keyframes drift {
    from { transform: translate(0,0); }
    to { transform: translate(-300px,-300px); }
}

header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 30px;
    border-bottom:1px solid #ff004f;
}

.glass {
    background: rgba(20,20,20,0.6);
    backdrop-filter: blur(8px);
    border:1px solid #ff004f;
    padding:20px;
    margin:20px;
}

button {
    background:black;
    border:1px solid #ff004f;
    color:#ff004f;
    padding:8px 16px;
    cursor:pointer;
    font-family:'Orbitron';
    transition:0.2s;
}

button:hover {
    background:#ff004f;
    color:black;
}

.energy-container {
    height:22px;
    background:#111;
    margin-top:10px;
}

.energy-bar {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#ff004f,#00d9ff);
    transition:0.4s ease;
}

.module {
    margin-bottom:15px;
    padding:15px;
    border:1px solid #00d9ff;
    transition:0.2s;
}

.module:hover {
    box-shadow:0 0 15px #00d9ff;
}

.small {
    padding:4px 8px;
    font-size:12px;
}
.danger {
    border-color:red;
    color:red;
}
.danger:hover {
    background:red;
    color:black;
}
</style>
</head>
<body>

<header>
    <div>
        <h2>LEOAF Command Center</h2>
        <div id="userEmail"></div>
    </div>
    <button id="logoutBtn">Exit Command</button>
</header>

<div class="glass">
    <h3>Energy Core</h3>
    <div class="energy-container">
        <div class="energy-bar" id="energyBar"></div>
    </div>
</div>

<div class="glass" id="modules"></div>

<div class="glass">
    <h3>System Controls</h3>
    <button class="danger" onclick="resetAll()">Reset Entire System</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const supabaseUrl = 'YOUR_URL';
const supabaseKey = 'YOUR_KEY';
const { createClient } = supabase;
const client = createClient(supabaseUrl, supabaseKey);

const modulesList = [
    "Foundations",
    "System Design",
    "Scalability",
    "Databases",
    "Security",
    "Architecture Patterns",
    "Performance",
    "Deployment"
];

let progress = JSON.parse(localStorage.getItem("leoafProgress")) || {};

document.addEventListener('DOMContentLoaded', async () => {

    const { data: { user } } = await client.auth.getUser();
    if(!user){
        window.location.href = "index.html";
        return;
    }

    document.getElementById("userEmail").innerText = user.email;

    renderModules();
    updateEnergy();

    document.getElementById("logoutBtn").addEventListener("click", async () => {
        await client.auth.signOut();
        window.location.href = "index.html";
    });
});

function renderModules(){
    const container = document.getElementById("modules");
    container.innerHTML = "<h3>Mission Modules</h3>";

    modulesList.forEach(module => {
        const mastered = progress[module];

        const div = document.createElement("div");
        div.className = "module";

        div.innerHTML = `
            <strong>${module}</strong><br>
            Status: ${mastered ? "MASTERED" : "IN PROGRESS"}<br><br>
            <button class="small" onclick="toggle('${module}')">
                ${mastered ? "Undo Mastery" : "Mark Mastered"}
            </button>
            <button class="small" onclick="resetModule('${module}')">
                Reset Module
            </button>
        `;

        container.appendChild(div);
    });
}

function toggle(module){
    progress[module] = !progress[module];
    localStorage.setItem("leoafProgress", JSON.stringify(progress));
    renderModules();
    updateEnergy();
}

function resetModule(module){
    if(confirm("Reset this module?")){
        delete progress[module];
        localStorage.setItem("leoafProgress", JSON.stringify(progress));
        renderModules();
        updateEnergy();
    }
}

function resetAll(){
    if(confirm("⚠️ This will wipe all progress. Continue?")){
        progress = {};
        localStorage.removeItem("leoafProgress");
        renderModules();
        updateEnergy();
    }
}

function updateEnergy(){
    const completed = Object.values(progress).filter(v => v).length;
    const percent = (completed / modulesList.length) * 100;
    document.getElementById("energyBar").style.width = percent + "%";
}
</script>

</body>
</html>
