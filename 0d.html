<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LEOAF Command Center – The Waiting Room</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Cinzel+Decorative:wght@700&family=Special+Elite&display=swap" rel="stylesheet">

  <style>
    :root {
      --red-room: #7a1212;        /* deep blood red */
      --red-room-dark: #4a0a0a;
      --gold-trim: #d4af37;
      --cream-text: #f5e8c7;
      --black-floor: #0f0f0f;
      --white-floor: #e0d0b0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Special Elite', serif;
      background: var(--red-room-dark);
      color: var(--cream-text);
      background-image:
        /* curtain texture simulation */
        linear-gradient(transparent 50%, rgba(0,0,0,0.4) 50%),
        repeating-linear-gradient(
          45deg,
          var(--red-room) 0,
          var(--red-room) 80px,
          #5c0c0c 80px,
          #5c0c0c 160px
        );
      background-size: 100% 100%, 400px 400px;
      animation: pulse 18s ease-in-out infinite;
      position: relative;
      overflow-x: hidden;
    }

    @keyframes pulse {
      0%,100% { filter: brightness(1) contrast(1.05); }
      50%     { filter: brightness(0.92) contrast(1.12); }
    }

    /* Black & white zigzag floor (classic Red Room pattern) */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: repeating-conic-gradient(
        from 45deg at 50% 50%,
        var(--black-floor) 0deg 90deg,
        var(--white-floor) 90deg 180deg
      );
      background-size: 120px 120px;
      opacity: 0.25;
      z-index: -2;
      pointer-events: none;
      mix-blend-mode: luminosity;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 3rem;
      background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
      border-bottom: 3px solid var(--gold-trim);
      backdrop-filter: blur(4px);
      position: relative;
      z-index: 10;
    }

    header h2 {
      font-family: 'Cinzel Decorative', cursive;
      font-weight: 700;
      color: var(--gold-trim);
      letter-spacing: 6px;
      font-size: 2.1rem;
      text-shadow: 0 0 12px rgba(212,175,55,0.5);
      margin: 0;
    }

    .email {
      font-family: 'Special Elite', serif;
      color: #c9a875;
      font-size: 1.1rem;
      opacity: 0.85;
    }

    button {
      background: transparent;
      border: 2px solid var(--gold-trim);
      color: var(--gold-trim);
      padding: 0.6rem 1.4rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: 500;
      letter-spacing: 1.5px;
      cursor: pointer;
      transition: all 0.4s ease;
      text-shadow: 0 0 6px rgba(212,175,55,0.6);
    }

    button:hover {
      background: var(--gold-trim);
      color: var(--red-room-dark);
      box-shadow: 0 0 20px rgba(212,175,55,0.7);
    }

    .container {
      max-width: 960px;
      margin: 3rem auto;
      padding: 0 1.5rem;
      position: relative;
      z-index: 5;
    }

    .progress-wrapper {
      margin-bottom: 3rem;
      background: rgba(0,0,0,0.6);
      padding: 1.5rem;
      border: 1px solid var(--gold-trim);
      border-radius: 0;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
    }

    .progress-bar {
      height: 14px;
      background: #111;
      border: 1px solid #444;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #d4af37, #f5e8c7, #d4af37);
      transition: width 0.8s ease;
      box-shadow: 0 0 15px rgba(212,175,55,0.6);
    }

    .section {
      border: 2px solid var(--gold-trim);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      background: rgba(20, 5, 5, 0.75);
      backdrop-filter: blur(2px);
      box-shadow: 0 0 25px rgba(0,0,0,0.9), inset 0 0 20px rgba(212,175,55,0.08);
      transition: transform 0.3s ease;
    }

    .section:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(212,175,55,0.25);
    }

    .section h3 {
      margin: 0 0 0.8rem;
      color: var(--gold-trim);
      font-family: 'Cinzel Decorative', cursive;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(212,175,55,0.5);
    }

    .section p {
      margin: 0.5rem 0 1rem;
      opacity: 0.9;
      font-size: 1.05rem;
    }

    .small-btn {
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
      margin-right: 0.8rem;
    }

    .danger {
      border-color: #c00;
      color: #ff4444;
    }

    .danger:hover {
      background: #c00;
      color: white;
      box-shadow: 0 0 20px #c00;
    }

    /* Very subtle curtain folds shadow */
    .container::before,
    .container::after {
      content: "";
      position: absolute;
      top: 0; bottom: 0;
      width: 120px;
      background: linear-gradient(to right, rgba(0,0,0,0.8), transparent);
      z-index: -1;
      pointer-events: none;
    }

    .container::before { left: -60px; }
    .container::after  { right: -60px; transform: scaleX(-1); }
  </style>
</head>
<body>

<header>
  <div>
    <h2>THE WAITING ROOM</h2>
    <div class="email" id="userEmail"></div>
  </div>
  <button id="logoutBtn">Leave this place</button>
</header>

<div class="container">

  <div class="progress-wrapper">
    <h3>Progress Through the Lodge</h3>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <div id="sections"></div>

  <button class="danger" onclick="resetAll()">Erase All Knowledge</button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// ────────────────────────────────────────────────
//   Your existing Supabase logic remains unchanged
//   (I only touched styles & minor title/header text)
// ────────────────────────────────────────────────

const supabaseUrl = 'https://kpkpptqtuuhnbdntuluc.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtwa3BwdHF0dXVobmJkbnR1bHVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNTE2MjAsImV4cCI6MjA4NjcyNzYyMH0.qUgRlbvjhi_cB7PTmSJLm62YFf3nJyYtJsnqbP97FrM';
const { createClient } = supabase;
const client = createClient(supabaseUrl, supabaseKey);

const sectionsList = [
  "Foundations of Architecture",
  "System Design Principles",
  "Scalability & Distributed Systems",
  "Database Design",
  "Security & Reliability",
  "Architecture Patterns",
  "Performance Optimization",
  "Deployment & DevOps"
];

let currentUser = null;
let progress = {};

document.addEventListener('DOMContentLoaded', async () => {
  const { data: { user } } = await client.auth.getUser();

  if (!user) {
    window.location.href = "index.html";
    return;
  }

  currentUser = user;
  document.getElementById("userEmail").innerText = user.email;

  await loadProgress();
  renderSections();
  updateProgress();

  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await client.auth.signOut();
    window.location.href = "index.html";
  });
});

async function loadProgress() {
  const { data, error } = await client
    .from('user_progress')
    .select('*')
    .eq('user_id', currentUser.id);

  if (error) {
    console.error(error);
    return;
  }

  progress = {};
  data.forEach(row => {
    progress[row.section] = row.mastered;
  });
}

function renderSections(){
  const container = document.getElementById("sections");
  container.innerHTML = "";

  sectionsList.forEach(section => {
    const mastered = progress[section];

    const div = document.createElement("div");
    div.className = "section";

    div.innerHTML = `
      <h3>${section}</h3>
      <p>${mastered ? "The shape has been mastered." : "It is waiting for you."}</p>
      <button class="small-btn" onclick="toggle('${section}')">
        ${mastered ? "Return it" : "Claim mastery"}
      </button>
    `;

    container.appendChild(div);
  });
}

async function toggle(section){
  const mastered = progress[section];

  if (mastered) {
    await client
      .from('user_progress')
      .delete()
      .eq('user_id', currentUser.id)
      .eq('section', section);

    delete progress[section];
  } else {
    await client
      .from('user_progress')
      .upsert({
        user_id: currentUser.id,
        section: section,
        mastered: true
      }, { onConflict: ['user_id', 'section'] });

    progress[section] = true;
  }

  renderSections();
  updateProgress();
}

function updateProgress(){
  const completed = Object.values(progress).filter(v => v).length;
  const percent = (completed / sectionsList.length) * 100;
  document.getElementById("progressFill").style.width = percent + "%";
}

// Optional: if you want real backwards speech feel, you could reverse section titles here
// (but it makes the UI hard to use — better as easter egg on hover or something)
</script>
</body>
</html>
