<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LEOAF Command Center – The Waiting Room</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Cinzel+Decorative:wght@700&family=Special+Elite&display=swap" rel="stylesheet">

  <style>
:root {
  --red-room: #7a1212;
  --red-room-dark: #4a0a0a;
  --gold-trim: #d4af37;
  --cream-text: #f5e8c7;
  --floor-dark: #2c1a0f;      /* dark brown-black from the actual floor */
  --floor-light: #c19a6b;     /* lighter brownish-beige */
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: 'Special Elite', serif;
  background: var(--red-room-dark);
  color: var(--cream-text);
  
  /* curtain-like background layer */
  background-image:
    linear-gradient(transparent 40%, rgba(0,0,0,0.5) 100%),
    repeating-linear-gradient(
      45deg,
      var(--red-room) 0,
      var(--red-room) 100px,
      #5c0c0c 100px,
      #5c0c0c 200px
    );
  background-size: 100% 100%, 600px 600px;
  animation: pulse 22s ease-in-out infinite;
  position: relative;
  overflow: hidden;
}

@keyframes pulse {
  0%,100% { filter: brightness(1) contrast(1.08); }
  50%     { filter: brightness(0.9) contrast(1.15); }
}

/* === ANIMATED ZIGZAG FLOOR – moving away / receding downward === */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    45deg,
    var(--floor-dark) 0px,
    var(--floor-dark) 40px,
    var(--floor-light) 40px,
    var(--floor-light) 80px
  );
  background-size: 120px 120px;          /* controls zigzag width/height */
  opacity: 0.45;                         /* was lower before – now more visible */
  z-index: -2;
  pointer-events: none;
  
  /* The movement: slow drift downward (away from viewer) */
  animation: 
    floorDrift 80s linear infinite,
    floorBreathe 18s ease-in-out infinite;
}

@keyframes floorDrift {
  from {
    background-position: 0 0;
  }
  to {
    background-position: 0 240px;        /* moves exactly 3× tile height = seamless loop */
  }
}

@keyframes floorBreathe {
  0%, 100% {
    transform: scale(1.02) translateY(0);
    filter: brightness(1);
  }
  50% {
    transform: scale(1.00) translateY(8px);
    filter: brightness(0.92);
  }
}

/* Optional subtle vignette / depth overlay to enhance "tunnel" feeling */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at 50% 30%,
    transparent 30%,
    rgba(0,0,0,0.7) 70%,
    black 100%
  );
  opacity: 0.6;
  pointer-events: none;
  z-index: -1;
}

/* Rest of your styles (header, container, sections, buttons etc.) remain the same */
  </style>
</head>
<body>

<header>
  <div>
    <h2>THE WAITING ROOM</h2>
    <div class="email" id="userEmail"></div>
  </div>
  <button id="logoutBtn">Leave this place</button>
</header>

<div class="container">

  <div class="progress-wrapper">
    <h3>Progress Through the Lodge</h3>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <div id="sections"></div>

  <button class="danger" onclick="resetAll()">Erase All Knowledge</button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// ────────────────────────────────────────────────
//   Your existing Supabase logic remains unchanged
//   (I only touched styles & minor title/header text)
// ────────────────────────────────────────────────

const supabaseUrl = 'https://kpkpptqtuuhnbdntuluc.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtwa3BwdHF0dXVobmJkbnR1bHVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNTE2MjAsImV4cCI6MjA4NjcyNzYyMH0.qUgRlbvjhi_cB7PTmSJLm62YFf3nJyYtJsnqbP97FrM';
const { createClient } = supabase;
const client = createClient(supabaseUrl, supabaseKey);

const sectionsList = [
  "Foundations of Architecture",
  "System Design Principles",
  "Scalability & Distributed Systems",
  "Database Design",
  "Security & Reliability",
  "Architecture Patterns",
  "Performance Optimization",
  "Deployment & DevOps"
];

let currentUser = null;
let progress = {};

document.addEventListener('DOMContentLoaded', async () => {
  const { data: { user } } = await client.auth.getUser();

  if (!user) {
    window.location.href = "index.html";
    return;
  }

  currentUser = user;
  document.getElementById("userEmail").innerText = user.email;

  await loadProgress();
  renderSections();
  updateProgress();

  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await client.auth.signOut();
    window.location.href = "index.html";
  });
});

async function loadProgress() {
  const { data, error } = await client
    .from('user_progress')
    .select('*')
    .eq('user_id', currentUser.id);

  if (error) {
    console.error(error);
    return;
  }

  progress = {};
  data.forEach(row => {
    progress[row.section] = row.mastered;
  });
}

function renderSections(){
  const container = document.getElementById("sections");
  container.innerHTML = "";

  sectionsList.forEach(section => {
    const mastered = progress[section];

    const div = document.createElement("div");
    div.className = "section";

    div.innerHTML = `
      <h3>${section}</h3>
      <p>${mastered ? "The shape has been mastered." : "It is waiting for you."}</p>
      <button class="small-btn" onclick="toggle('${section}')">
        ${mastered ? "Return it" : "Claim mastery"}
      </button>
    `;

    container.appendChild(div);
  });
}

async function toggle(section){
  const mastered = progress[section];

  if (mastered) {
    await client
      .from('user_progress')
      .delete()
      .eq('user_id', currentUser.id)
      .eq('section', section);

    delete progress[section];
  } else {
    await client
      .from('user_progress')
      .upsert({
        user_id: currentUser.id,
        section: section,
        mastered: true
      }, { onConflict: ['user_id', 'section'] });

    progress[section] = true;
  }

  renderSections();
  updateProgress();
}

function updateProgress(){
  const completed = Object.values(progress).filter(v => v).length;
  const percent = (completed / sectionsList.length) * 100;
  document.getElementById("progressFill").style.width = percent + "%";
}

// Optional: if you want real backwards speech feel, you could reverse section titles here
// (but it makes the UI hard to use — better as easter egg on hover or something)
</script>
</body>
</html>
